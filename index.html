<script>
  async function openWhatsApp() {
    const mobile = document.getElementById("mobile").value.trim();
    if (!mobile) {
      alert("Please enter your mobile number.");
      return;
    }

    // STEP 1: Update Google Sheet
    const sheetURL = "YOUR_WEB_APP_URL_HERE"; // Replace with actual Web App URL
    try {
      await fetch(sheetURL, {
        method: "POST",
        body: new URLSearchParams({ mobile }),
      });
    } catch (error) {
      console.error("Error updating sheet:", error);
    }

    // STEP 2: WhatsApp Message
    const now = new Date();
    const options = { month: 'short', year: 'numeric' };
    const monthYear = now.toLocaleDateString('en-US', options);

    const msg = `*Monthly member donation of ${monthYear}*\n` +
      `for *Masjid-e-Usman*,\n` +
      `Usmania Colony, Kondhwa Kh, Pune - 411048\n\n` +
      `*Member ID :* <'Member IDs'!$E$2>\n` +
      `Amount : \n` +
      `Name : \n` +
      `Flat Number : \n` +
      `Building Name : \n` +
      `Registered Mobile : ${mobile}\n\n` +
      `Payment Snap is also attached\n` +
      `*جزاک اللہ خیرا کثیر ہ*`;

    const encodedMsg = encodeURIComponent(msg);
    const waLink = `https://wa.me/918446327952?text=${encodedMsg}`;
    window.open(waLink, "_blank");
  }
</script>
